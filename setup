#!/bin/bash 
downloadfolder="/home/$USER/Downloads"  #location for downloaded installation files

whoisthis="Eric Harrison"  #your name, used for Git config
youremail="ericmharrison@gmail.com"  #your email, used for Git config

#update package list and upgrade all software
sudo apt-get update 2>/dev/null && sudo apt-get -fy full-upgrade
sudo apt -fy install software-properties-common apt-transport-https wget

#check for git
hasgit=$(apt list git --installed 2>/dev/null)
if [ "$hasgit" == "Listing..." ]
then
  echo "Git's not installed! Let's fix that!"
  sudo apt-get -fy install git
fi

#congratulate yourself
echo
echo "Git is installed: $(git --version)"

#configure git
git config --global --replace-all user.name "$whoisthis"
git config --global user.email "$youremail"
echo
echo "Git User Name: $(git config --global --get user.name)"
echo "Git User Email: $(git config --global --get user.email)"

#add keys for new repositories
echo "Adding keys"
while read key
do
  echo $key
  wget -q $key -O- | sudo apt-key add -
done <keys

#download packages from list in file
while read url
do
  wget -nc --directory-prefix="$downloadfolder"  $url
done <files

#install Go
if [ ! -d "$HOME/go" ]
then
  tar -xvf /home/eric/Downloads/go1.14.4.linux-amd64.tar.gz
  sudo chown -R root:root ./go
  sudo mv go /usr/local
  sudo echo "export GOPATH=$HOME/go" >> ~/.profile
  sudo echo "export PATH=$PATH:/usr/local/go/bin:$GOPATH/bin" >> ~/.profile
  source ~/.profile
else
  echo "Go is already installed"
fi

#add repositories for package downloads
echo "Adding repositories"
while read repo
do
  echo $repo
  sudo add-apt-repository "$repo" 2>/dev/null
done <repositories
sudo apt update 2>/dev/null

#uninstall old Docker versions if they exist
sudo apt-get -fy remove docker docker-engine docker.io containerd runc 2>/dev/null

#install apt packages from list in the file
while read pkg
do
  pkginstalled=$(apt list $pkg --installed 2>/dev/null)
  if [ "$pkginstalled" == "Listing..." ]
  then
    echo "Installing $pkg"
    sudo apt-get -fy install $pkg
    echo ${pkginstalled:11}
  else
    echo ${pkginstalled:11}
  fi
done <packages

#configure Docker
sudo groupadd docker
sudo usermod -aG docker ${USER}

#install Stern
if [ ! -d "$GOPATH/src/github.com/wercker" ]
then
  mkdir -p $GOPATH/src/github.com/wercker
  cd $GOPATH/src/github.com/wercker
  git clone https://github.com/wercker/stern.git && cd stern
  govendor sync
  go install
  stern -v
  echo "Stern installed successfully"
else
  echo "Stern is already installed"
  stern -v
fi

#install Kind
if [ ! -f "/usr/local/go/kind" ]
then 
  GO111MODULE="on" go get sigs.k8s.io/kind@v0.8.1
  kind --version
  echo "Kind installed successfully"
else
  echo "Kind is already installed"
  kind --version
fi

#install Terraform
if [ ! -f "/usr/local/bin/terraform" ]
then
  sudo unzip "$downloadfolder/terraform_0.12.28_linux_amd64" -d /usr/local/bin
  terraform -version
  echo "Terraform installed successfully"
else
  echo "Terraform is already installed"
  terraform -version
fi
