#!/bin/bash 
#setup script for dev environment

#general info
downloadfolder="$HOME/Downloads"  #location for downloaded installation files

#git info
gitfolder="/usr" #git install location
gitrepo="https://git.kernel.org/pub/scm/git/git.git" #remote repo to clone git source from
whoisthis="Eric Harrison"  #your name, used for Git config
youremail="ericmharrison@gmail.com"  #your email, used for Git config

#go info
goroot="$HOME/goroot" #go source location
gopath="$HOME/go" #user go location for GOPATH
gorepo="https://github.com/golang/go" #git repo for golang source
gobootstrap="release-branch.go1.4" #branch for go bootstrap toolchain
gobranch="release-branch.go1.14" #branch to install go from
goversion="go1.14.4" #go release to install

#update package list and upgrade all software
sudo apt-get update && sudo apt-get -fy upgrade

##########################
####                  ####
####       GIT        ####
####                  ####

#check for any git and install if missing
if [ $(find "$gitfolder/bin" -name git) ]
  then 
    echo "Git exists - continuing..."
  else 
    echo "No Git - installing..."
    sudo apt-get install git
fi

#configure git
git config --global --replace-all user.name "$whoisthis"
git config --global user.email "$youremail"
git config --global pull.rebase false
echo
echo "Git User Name: $(git config --global --get user.name)"
echo "Git User Email: $(git config --global --get user.email)"

#pull and install latest version of git

#install prerequisite git packages
sudo apt-get -fy install libcurl4-gnutls-dev\
                         libexpat1-dev\
                         gettext\
                         libz-dev\
                         libssl-dev\
                         asciidoc\
                         xmlto\
                         docbook2x

#clone git repo if it doesn't already exist, then build & install git
if [ ! -d ~/git ]
  then
    cd ~
    git clone $gitrepo
    cd ~/git
    make all doc info prefix="$gitfolder"
    sudo make install install-doc install-html install-man prefix="$gitfolder"
  else #if git exists, make sure it's the latest version
    cd ~/git
    git_updated=$(git pull)
    if [ "$git_updated" == "Already up to date." ]
      then
        echo "Git is already up to date."
      else
        make all doc info prefix="$gitfolder"
        sudo make install install-doc install-html install-man prefix="$gitfolder"
    fi
fi
#display git version
git version

####                  #### 
####     END GIT      #### 
####                  ####
##########################

##########################
####                  ####
####        GO        ####
####                  ####

#check for go bootstrap
cd ~
if [ ! -d /go1.4 ]
then
  mkdir go1.4
  git clone --single-branch --branch $gobootstrap $gorepo go1.4
  cd go1.4/src
  export CGO_ENABLED=0
  ./make.bash
fi

#check for go install
if [ ! -d $goroot/bin ]
then
  mkdir $goroot
  git clone --single-branch --branch $gobranch $gorepo goroot
  cd $goroot
  git checkout $goversion
  cd src
  ./all.bash
  PATH=$PATH:$goroot/bin
fi

#create local go folder and set GOPATH
if [ ! -d $gopath ]
then
  mkdir $gopath
  cd $gopath
  mkdir bin
  go env -w GOPATH=$gopath
fi

####                  #### 
####      END GO      #### 
####                  ####
##########################

